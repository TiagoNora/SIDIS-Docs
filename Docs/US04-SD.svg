<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1524px" preserveAspectRatio="none" style="width:2364px;height:1524px;background:#FFFFFF;" version="1.1" viewBox="0 0 2364 1524" width="2364px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="185" x="1088.5" y="30.1074">Review and rate a product</text><rect fill="#FFFFFF" height="1150.5645" style="stroke:#181818;stroke-width:1.0;" width="10" x="22.5" y="281.6973"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:1.0;" width="10" x="27.5" y="1423.2617"/><rect fill="#FFFFFF" height="1119.2734" style="stroke:#181818;stroke-width:1.0;" width="10" x="172.5" y="312.9883"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="267.5" y="982.7695"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="383.5" y="1058.3516"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="499.5" y="1133.9336"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="615.5" y="1209.5156"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="731.5" y="1285.0977"/><rect fill="#FFFFFF" height="1047.6914" style="stroke:#181818;stroke-width:1.0;" width="10" x="847.5" y="344.2793"/><rect fill="#FFFFFF" height="1056.6914" style="stroke:#181818;stroke-width:1.0;" width="10" x="1072.5" y="375.5703"/><rect fill="#FFFFFF" height="708.1504" style="stroke:#181818;stroke-width:1.0;" width="10" x="1077.5" y="652.5293"/><rect fill="#FFFFFF" height="57.582" style="stroke:#181818;stroke-width:1.0;" width="10" x="1326.5" y="406.8613"/><rect fill="#FFFFFF" height="93.873" style="stroke:#181818;stroke-width:1.0;" width="10" x="1551.5" y="512.3652"/><rect fill="#FFFFFF" height="93.873" style="stroke:#181818;stroke-width:1.0;" width="10" x="1551.5" y="688.8203"/><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="1728" y="543.6563"/><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="1848" y="720.1113"/><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="2123.5" y="888.8965"/><rect fill="#FFFFFF" height="1275.7285" style="stroke:#181818;stroke-width:1.0;" width="10" x="2294.5" y="156.5332"/><rect fill="#FFFFFF" height="1244.4375" style="stroke:#181818;stroke-width:1.0;" width="10" x="2299.5" y="187.8242"/><rect fill="#FFFFFF" height="1213.1465" style="stroke:#181818;stroke-width:1.0;" width="10" x="2304.5" y="219.1152"/><rect fill="#FFFFFF" height="1181.8555" style="stroke:#181818;stroke-width:1.0;" width="10" x="2309.5" y="250.4063"/><rect fill="#FFFFFF" height="1150.5645" style="stroke:#181818;stroke-width:1.0;" width="10" x="2314.5" y="281.6973"/><rect fill="#FFFFFF" height="480.7832" style="stroke:#181818;stroke-width:1.0;" width="10" x="2319.5" y="951.4785"/><rect fill="none" height="192.377" style="stroke:#000000;stroke-width:1.5;" width="834" x="969" y="421.8613"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="27" x2="27" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="177" x2="177" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="272" x2="272" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="388" x2="388" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="504" x2="504" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="620.5" x2="620.5" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="736.5" x2="736.5" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="852" x2="852" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1077" x2="1077" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1331" x2="1331" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1556" x2="1556" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1733" x2="1733" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1853" x2="1853" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1964" x2="1964" y1="822.5039" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2128" x2="2128" y1="123.2422" y2="1441.2617"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="2299" x2="2299" y1="123.2422" y2="1441.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="5" y="119.7285">ACME</text><ellipse cx="27.5" cy="53.1211" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.5,61.1211 L27.5,88.1211 M14.5,69.1211 L40.5,69.1211 M27.5,88.1211 L14.5,103.1211 M27.5,88.1211 L40.5,103.1211 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="5" y="1455.3691">ACME</text><ellipse cx="27.5" cy="1467.3828" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.5,1475.3828 L27.5,1502.3828 M14.5,1483.3828 L40.5,1483.3828 M27.5,1502.3828 L14.5,1517.3828 M27.5,1502.3828 L40.5,1517.3828 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="137" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="144" y="111.7285">:ReviewC1</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="137" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="144" y="1462.3691">:ReviewC1</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89" x="228" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="235" y="111.7285">:ReviewC_n</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="89" x="228" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="235" y="1462.3691">:ReviewC_n</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="356" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="363" y="111.7285">:VoteC1</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="356" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="363" y="1462.3691">:VoteC1</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="468" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="475" y="111.7285">:VoteC_n</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="468" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="475" y="1462.3691">:VoteC_n</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="579.5" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="586.5" y="111.7285">:ReviewQ1</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="579.5" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="586.5" y="1462.3691">:ReviewQ1</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="691.5" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="698.5" y="111.7285">:ReviewQ_n</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="691.5" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="698.5" y="1462.3691">:ReviewQ_n</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="792" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="799" y="111.7285">ReviewController</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="792" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="799" y="1462.3691">ReviewController</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197" x="979" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183" x="986" y="111.7285">reviewService:ReviewService</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197" x="979" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183" x="986" y="1462.3691">reviewService:ReviewService</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="1223" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="1230" y="111.7285">productRepo:ProductRepository</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="1223" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="1230" y="1462.3691">productRepo:ProductRepository</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="1450" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="1457" y="111.7285">requestService:RequestService</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="1450" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="1457" y="1462.3691">requestService:RequestService</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="1673" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1680" y="111.7285">:ProductInstance</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="1673" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1680" y="1462.3691">:ProductInstance</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="1803" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="1810" y="111.7285">:AuthInstance</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="1803" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="1810" y="1462.3691">:AuthInstance</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="1913" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1920" y="1462.3691">review:Review</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="205" x="2026" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="2033" y="111.7285">reviewRepo:ReviewRepository</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="205" x="2026" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="2033" y="1462.3691">reviewRepo:ReviewRepository</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="2241" y="89.6211"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="2248" y="111.7285">:MessageBroker</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="2241" y="1440.2617"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="2248" y="1462.3691">:MessageBroker</text><rect fill="#FFFFFF" height="1150.5645" style="stroke:#181818;stroke-width:1.0;" width="10" x="22.5" y="281.6973"/><rect fill="#FFFFFF" height="9" style="stroke:#181818;stroke-width:1.0;" width="10" x="27.5" y="1423.2617"/><rect fill="#FFFFFF" height="1119.2734" style="stroke:#181818;stroke-width:1.0;" width="10" x="172.5" y="312.9883"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="267.5" y="982.7695"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="383.5" y="1058.3516"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="499.5" y="1133.9336"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="615.5" y="1209.5156"/><rect fill="#FFFFFF" height="37.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="731.5" y="1285.0977"/><rect fill="#FFFFFF" height="1047.6914" style="stroke:#181818;stroke-width:1.0;" width="10" x="847.5" y="344.2793"/><rect fill="#FFFFFF" height="1056.6914" style="stroke:#181818;stroke-width:1.0;" width="10" x="1072.5" y="375.5703"/><rect fill="#FFFFFF" height="708.1504" style="stroke:#181818;stroke-width:1.0;" width="10" x="1077.5" y="652.5293"/><rect fill="#FFFFFF" height="57.582" style="stroke:#181818;stroke-width:1.0;" width="10" x="1326.5" y="406.8613"/><rect fill="#FFFFFF" height="93.873" style="stroke:#181818;stroke-width:1.0;" width="10" x="1551.5" y="512.3652"/><rect fill="#FFFFFF" height="93.873" style="stroke:#181818;stroke-width:1.0;" width="10" x="1551.5" y="688.8203"/><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="1728" y="543.6563"/><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="1848" y="720.1113"/><rect fill="#FFFFFF" height="31.291" style="stroke:#181818;stroke-width:1.0;" width="10" x="2123.5" y="888.8965"/><rect fill="#FFFFFF" height="1275.7285" style="stroke:#181818;stroke-width:1.0;" width="10" x="2294.5" y="156.5332"/><rect fill="#FFFFFF" height="1244.4375" style="stroke:#181818;stroke-width:1.0;" width="10" x="2299.5" y="187.8242"/><rect fill="#FFFFFF" height="1213.1465" style="stroke:#181818;stroke-width:1.0;" width="10" x="2304.5" y="219.1152"/><rect fill="#FFFFFF" height="1181.8555" style="stroke:#181818;stroke-width:1.0;" width="10" x="2309.5" y="250.4063"/><rect fill="#FFFFFF" height="1150.5645" style="stroke:#181818;stroke-width:1.0;" width="10" x="2314.5" y="281.6973"/><rect fill="#FFFFFF" height="480.7832" style="stroke:#181818;stroke-width:1.0;" width="10" x="2319.5" y="951.4785"/><polygon fill="#181818" points="2282.5,152.5332,2292.5,156.5332,2282.5,160.5332,2286.5,156.5332" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="272.5" x2="2288.5" y1="156.5332" y2="156.5332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="279.5" y="151.2705">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="290.5" y="151.2705">subscribe "Review.created"</text><polygon fill="#181818" points="2287.5,183.8242,2297.5,187.8242,2287.5,191.8242,2291.5,187.8242" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="388.5" x2="2293.5" y1="187.8242" y2="187.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="395.5" y="182.5615">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="406.5" y="182.5615">subscribe "Review.created"</text><polygon fill="#181818" points="2292.5,215.1152,2302.5,219.1152,2292.5,223.1152,2296.5,219.1152" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="504.5" x2="2298.5" y1="219.1152" y2="219.1152"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="511.5" y="213.8525">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="522.5" y="213.8525">subscribe "Review.created"</text><polygon fill="#181818" points="2297.5,246.4063,2307.5,250.4063,2297.5,254.4063,2301.5,250.4063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="620.5" x2="2303.5" y1="250.4063" y2="250.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="627.5" y="245.1436">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="638.5" y="245.1436">subscribe "Review.created"</text><polygon fill="#181818" points="2302.5,277.6973,2312.5,281.6973,2302.5,285.6973,2306.5,281.6973" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="736.5" x2="2308.5" y1="281.6973" y2="281.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="743.5" y="276.4346">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="754.5" y="276.4346">subscribe "Review.created"</text><polygon fill="#181818" points="160.5,308.9883,170.5,312.9883,160.5,316.9883,164.5,312.9883" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="32.5" x2="166.5" y1="312.9883" y2="312.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="39.5" y="307.7256">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="50.5" y="307.7256">POST/reviews{sku}</text><polygon fill="#181818" points="835.5,340.2793,845.5,344.2793,835.5,348.2793,839.5,344.2793" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="182.5" x2="841.5" y1="344.2793" y2="344.2793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="189.5" y="339.0166">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="200.5" y="339.0166">POST/reviews{sku}</text><polygon fill="#181818" points="1060.5,371.5703,1070.5,375.5703,1060.5,379.5703,1064.5,375.5703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="857.5" x2="1066.5" y1="375.5703" y2="375.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="864.5" y="370.3076">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="875.5" y="370.3076">create(reviewDTO, sku, request)</text><polygon fill="#181818" points="1314.5,402.8613,1324.5,406.8613,1314.5,410.8613,1318.5,406.8613" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1082.5" x2="1320.5" y1="406.8613" y2="406.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="1089.5" y="401.5986">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1100.5" y="401.5986">productRepo.findBySkuProduct(sku);</text><path d="M969,421.8613 L1030,421.8613 L1030,431.1523 L1020,441.1523 L969,441.1523 L969,421.8613 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="192.377" style="stroke:#000000;stroke-width:1.5;" width="834" x="969" y="421.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="984" y="436.8896">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="84" x="1045" y="435.7314">[success case]</text><polygon fill="#181818" points="1093.5,460.4434,1083.5,464.4434,1093.5,468.4434,1089.5,464.4434" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1087.5" x2="1330.5" y1="464.4434" y2="464.4434"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1099.5" y="459.1807">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="1117.5" y="459.1807">product</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="969" x2="1803" y1="473.4434" y2="473.4434"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="89" x="974" y="485.3135">[product == null]</text><polygon fill="#181818" points="1539.5,508.3652,1549.5,512.3652,1539.5,516.3652,1543.5,512.3652" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1082.5" x2="1545.5" y1="512.3652" y2="512.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1089.5" y="507.1025">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="1107.5" y="507.1025">retrieveProductFromApi(sku)</text><polygon fill="#181818" points="1716,539.6563,1726,543.6563,1716,547.6563,1720,543.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1561.5" x2="1722" y1="543.6563" y2="543.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1568.5" y="538.3936">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="1586.5" y="538.3936">GET /products/{sku}</text><polygon fill="#181818" points="1572.5,570.9473,1562.5,574.9473,1572.5,578.9473,1568.5,574.9473" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1566.5" x2="1732" y1="574.9473" y2="574.9473"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1578.5" y="569.6846">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="1596.5" y="569.6846">product</text><polygon fill="#181818" points="1093.5,602.2383,1083.5,606.2383,1093.5,610.2383,1089.5,606.2383" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1087.5" x2="1555.5" y1="606.2383" y2="606.2383"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1099.5" y="600.9756">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="1117.5" y="600.9756">product</text><line style="stroke:#181818;stroke-width:1.0;" x1="1082.5" x2="1129.5" y1="639.5293" y2="639.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="1129.5" x2="1129.5" y1="639.5293" y2="652.5293"/><line style="stroke:#181818;stroke-width:1.0;" x1="1088.5" x2="1129.5" y1="652.5293" y2="652.5293"/><polygon fill="#181818" points="1098.5,648.5293,1088.5,652.5293,1098.5,656.5293,1094.5,652.5293" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1094.5" y="634.2666">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="1112.5" y="634.2666">jwt = parseJwt(request)</text><polygon fill="#181818" points="1539.5,684.8203,1549.5,688.8203,1539.5,692.8203,1543.5,688.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1087.5" x2="1545.5" y1="688.8203" y2="688.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1094.5" y="683.5576">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="1112.5" y="683.5576">makeRequestToAuthentication(jwt)</text><polygon fill="#181818" points="1836,716.1113,1846,720.1113,1836,724.1113,1840,720.1113" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1561.5" x2="1842" y1="720.1113" y2="720.1113"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1568.5" y="714.8486">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1586.5" y="714.8486">GET /auth/search/{jwt}</text><polygon fill="#181818" points="1572.5,747.4023,1562.5,751.4023,1572.5,755.4023,1568.5,751.4023" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1566.5" x2="1852" y1="751.4023" y2="751.4023"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1578.5" y="746.1396">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="1596.5" y="746.1396">user</text><polygon fill="#181818" points="1098.5,778.6934,1088.5,782.6934,1098.5,786.6934,1094.5,782.6934" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1092.5" x2="1555.5" y1="782.6934" y2="782.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1104.5" y="777.4307">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="1122.5" y="777.4307">user</text><polygon fill="#181818" points="1901,809.9844,1911,813.9844,1901,817.9844,1905,813.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1087.5" x2="1907" y1="813.9844" y2="813.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1094.5" y="808.7217">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="1112.5" y="808.7217">create(reviewDTO,sku,user.getId())</text><rect fill="#E2E2F0" height="32.6211" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="1913" y="790.6934"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1920" y="812.8008">review:Review</text><polygon fill="#181818" points="1098.5,853.6055,1088.5,857.6055,1098.5,861.6055,1094.5,857.6055" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1092.5" x2="1963.5" y1="857.6055" y2="857.6055"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1104.5" y="852.3428">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="1122.5" y="852.3428">review</text><polygon fill="#181818" points="2111.5,884.8965,2121.5,888.8965,2111.5,892.8965,2115.5,888.8965" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1087.5" x2="2117.5" y1="888.8965" y2="888.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1094.5" y="883.6338">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="1112.5" y="883.6338">reviewRepo.save(review)</text><polygon fill="#181818" points="1098.5,916.1875,1088.5,920.1875,1098.5,924.1875,1094.5,920.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1092.5" x2="2127.5" y1="920.1875" y2="920.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1104.5" y="914.9248">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="1122.5" y="914.9248">ok</text><polygon fill="#181818" points="2307.5,947.4785,2317.5,951.4785,2307.5,955.4785,2311.5,951.4785" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1087.5" x2="2313.5" y1="951.4785" y2="951.4785"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="1094.5" y="946.2158">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="1112.5" y="946.2158">publish "Review.created, {Review}"</text><polygon fill="#181818" points="288.5,978.7695,278.5,982.7695,288.5,986.7695,284.5,982.7695" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="282.5" x2="2318.5" y1="982.7695" y2="982.7695"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="294.5" y="977.5068">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="312.5" y="977.5068">notify "Review.created, {Review}"</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="277.5" x2="319.5" y1="1019.0605" y2="1019.0605"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="319.5" x2="319.5" y1="1019.0605" y2="1032.0605"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272.5" x2="319.5" y1="1032.0605" y2="1032.0605"/><polygon fill="#181818" points="282.5,1028.0605,272.5,1032.0605,282.5,1036.0605,278.5,1032.0605" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="284.5" y="1013.7979">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="302.5" y="1013.7979">save(Review)</text><polygon fill="#181818" points="404.5,1054.3516,394.5,1058.3516,404.5,1062.3516,400.5,1058.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="398.5" x2="2318.5" y1="1058.3516" y2="1058.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="410.5" y="1053.0889">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="428.5" y="1053.0889">notify "Review.created, {Review}"</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="393.5" x2="435.5" y1="1094.6426" y2="1094.6426"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="435.5" x2="435.5" y1="1094.6426" y2="1107.6426"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="388.5" x2="435.5" y1="1107.6426" y2="1107.6426"/><polygon fill="#181818" points="398.5,1103.6426,388.5,1107.6426,398.5,1111.6426,394.5,1107.6426" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="400.5" y="1089.3799">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="418.5" y="1089.3799">save(Review)</text><polygon fill="#181818" points="520.5,1129.9336,510.5,1133.9336,520.5,1137.9336,516.5,1133.9336" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="514.5" x2="2318.5" y1="1133.9336" y2="1133.9336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="526.5" y="1128.6709">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="544.5" y="1128.6709">notify "Review.created, {Review}"</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="509.5" x2="551.5" y1="1170.2246" y2="1170.2246"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="551.5" x2="551.5" y1="1170.2246" y2="1183.2246"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="504.5" x2="551.5" y1="1183.2246" y2="1183.2246"/><polygon fill="#181818" points="514.5,1179.2246,504.5,1183.2246,514.5,1187.2246,510.5,1183.2246" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="516.5" y="1164.9619">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="534.5" y="1164.9619">save(Review)</text><polygon fill="#181818" points="636.5,1205.5156,626.5,1209.5156,636.5,1213.5156,632.5,1209.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="630.5" x2="2318.5" y1="1209.5156" y2="1209.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="642.5" y="1204.2529">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="660.5" y="1204.2529">notify "Review.created, {Review}"</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="625.5" x2="667.5" y1="1245.8066" y2="1245.8066"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="667.5" x2="667.5" y1="1245.8066" y2="1258.8066"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="620.5" x2="667.5" y1="1258.8066" y2="1258.8066"/><polygon fill="#181818" points="630.5,1254.8066,620.5,1258.8066,630.5,1262.8066,626.5,1258.8066" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="632.5" y="1240.5439">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="650.5" y="1240.5439">save(Review)</text><polygon fill="#181818" points="752.5,1281.0977,742.5,1285.0977,752.5,1289.0977,748.5,1285.0977" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="746.5" x2="2318.5" y1="1285.0977" y2="1285.0977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="758.5" y="1279.835">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="776.5" y="1279.835">notify "Review.created, {Review}"</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="741.5" x2="783.5" y1="1321.3887" y2="1321.3887"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="783.5" x2="783.5" y1="1321.3887" y2="1334.3887"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="736.5" x2="783.5" y1="1334.3887" y2="1334.3887"/><polygon fill="#181818" points="746.5,1330.3887,736.5,1334.3887,746.5,1338.3887,742.5,1334.3887" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="748.5" y="1316.126">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="766.5" y="1316.126">save(Review)</text><polygon fill="#181818" points="868.5,1356.6797,858.5,1360.6797,868.5,1364.6797,864.5,1360.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="862.5" x2="1071.5" y1="1360.6797" y2="1360.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="874.5" y="1355.417">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="892.5" y="1355.417">ok</text><polygon fill="#181818" points="193.5,1387.9707,183.5,1391.9707,193.5,1395.9707,189.5,1391.9707" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="187.5" x2="851.5" y1="1391.9707" y2="1391.9707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="199.5" y="1386.708">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="217.5" y="1386.708">ok</text><polygon fill="#181818" points="48.5,1419.2617,38.5,1423.2617,48.5,1427.2617,44.5,1423.2617" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="42.5" x2="171.5" y1="1423.2617" y2="1423.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="54.5" y="1417.999">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="72.5" y="1417.999">ok</text><!--MD5=[c7c89854d452b13f595e5bbb43a18ab8]
@startuml
'https://plantuml.com/sequence-diagram
title Review and rate a product
autoactivate on
autonumber

actor "ACME" as User

participant ":ReviewC1" as reviewC
participant ":ReviewC_n" as reviewC_n
participant ":VoteC1" as voteC
participant ":VoteC_n" as voteC_n
participant ":ReviewQ1" as reviewQ
participant ":ReviewQ_n" as reviewQ_n

participant "ReviewController" as Ctrl
participant "reviewService:ReviewService" as Svc
participant "productRepo:ProductRepository" as repository
participant "requestService:RequestService" as request
participant ":ProductInstance" as instance
participant ":AuthInstance" as instanceAuth
participant "review:Review" as review
participant "reviewRepo:ReviewRepository" as Repo

participant ":MessageBroker" as broker


reviewC_n -> broker: subscribe "Review.created"
voteC -> broker: subscribe "Review.created"
voteC_n -> broker: subscribe "Review.created"
reviewQ -> broker: subscribe "Review.created"
reviewQ_n -> broker: subscribe "Review.created"

activate User
User -> reviewC : POST/reviews{sku}
reviewC -> Ctrl: POST/reviews{sku}


Ctrl -> Svc : create(reviewDTO, sku, request)
Svc -> repository : productRepo.findBySkuProduct(sku);
alt success case
repository - -> Svc : product
else product == null
Svc -> request:retrieveProductFromApi(sku)
request -> instance: GET /products/{sku}
instance - -> request: product
request - -> Svc: product
end
Svc -> Svc: jwt = parseJwt(request)
Svc -> request: makeRequestToAuthentication(jwt)
request -> instanceAuth: GET /auth/search/{jwt}
instanceAuth - -> request: user
request - -> Svc: user
Svc -> review** : create(reviewDTO,sku,user.getId())
review - -> Svc :  review
Svc -> Repo : reviewRepo.save(review)
Repo - -> Svc : ok

Svc -> broker: publish "Review.created, {Review}"
reviewC_n <- broker: notify "Review.created, {Review}"
reviewC_n - -> reviewC_n: save(Review)
voteC <- broker: notify "Review.created, {Review}"
voteC - -> voteC: save(Review)
voteC_n <- broker: notify "Review.created, {Review}"
voteC_n - -> voteC_n: save(Review)
reviewQ <- broker: notify "Review.created, {Review}"
reviewQ - -> reviewQ: save(Review)
reviewQ_n <- broker: notify "Review.created, {Review}"
reviewQ_n - -> reviewQ_n: save(Review)
Svc - -> Ctrl : ok
Ctrl - -> reviewC : ok
reviewC -> User: ok

@enduml

@startuml
title Review and rate a product
autoactivate on
autonumber

actor "ACME" as User

participant ":ReviewC1" as reviewC
participant ":ReviewC_n" as reviewC_n
participant ":VoteC1" as voteC
participant ":VoteC_n" as voteC_n
participant ":ReviewQ1" as reviewQ
participant ":ReviewQ_n" as reviewQ_n

participant "ReviewController" as Ctrl
participant "reviewService:ReviewService" as Svc
participant "productRepo:ProductRepository" as repository
participant "requestService:RequestService" as request
participant ":ProductInstance" as instance
participant ":AuthInstance" as instanceAuth
participant "review:Review" as review
participant "reviewRepo:ReviewRepository" as Repo

participant ":MessageBroker" as broker


reviewC_n -> broker: subscribe "Review.created"
voteC -> broker: subscribe "Review.created"
voteC_n -> broker: subscribe "Review.created"
reviewQ -> broker: subscribe "Review.created"
reviewQ_n -> broker: subscribe "Review.created"

activate User
User -> reviewC : POST/reviews{sku}
reviewC -> Ctrl: POST/reviews{sku}


Ctrl -> Svc : create(reviewDTO, sku, request)
Svc -> repository : productRepo.findBySkuProduct(sku);
alt success case
repository - -> Svc : product
else product == null
Svc -> request:retrieveProductFromApi(sku)
request -> instance: GET /products/{sku}
instance - -> request: product
request - -> Svc: product
end
Svc -> Svc: jwt = parseJwt(request)
Svc -> request: makeRequestToAuthentication(jwt)
request -> instanceAuth: GET /auth/search/{jwt}
instanceAuth - -> request: user
request - -> Svc: user
Svc -> review** : create(reviewDTO,sku,user.getId())
review - -> Svc :  review
Svc -> Repo : reviewRepo.save(review)
Repo - -> Svc : ok

Svc -> broker: publish "Review.created, {Review}"
reviewC_n <- broker: notify "Review.created, {Review}"
reviewC_n - -> reviewC_n: save(Review)
voteC <- broker: notify "Review.created, {Review}"
voteC - -> voteC: save(Review)
voteC_n <- broker: notify "Review.created, {Review}"
voteC_n - -> voteC_n: save(Review)
reviewQ <- broker: notify "Review.created, {Review}"
reviewQ - -> reviewQ: save(Review)
reviewQ_n <- broker: notify "Review.created, {Review}"
reviewQ_n - -> reviewQ_n: save(Review)
Svc - -> Ctrl : ok
Ctrl - -> reviewC : ok
reviewC -> User: ok

@enduml

PlantUML version 1.2022.13(Sat Nov 19 13:22:17 WET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: pt
Country: PT
--></g></svg>