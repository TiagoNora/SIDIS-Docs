<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="829px" preserveAspectRatio="none" style="width:1562px;height:829px;background:#FFFFFF;" version="1.1" viewBox="0 0 1562 829" width="1562px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="25.6406" id="_title" style="stroke:none;stroke-width:1.0;" width="195" x="682.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="185" x="687.5" y="27.6738">Review and rate a product</text><rect fill="#FFFFFF" height="612.875" style="stroke:#181818;stroke-width:1.0;" width="10" x="22.5" y="127.2813"/><rect fill="#FFFFFF" height="583.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="172.5" y="147.8047"/><rect fill="#FFFFFF" height="563.8281" style="stroke:#181818;stroke-width:1.0;" width="10" x="397.5" y="176.3281"/><rect fill="#FFFFFF" height="273.8281" style="stroke:#181818;stroke-width:1.0;" width="10" x="402.5" y="428.8047"/><rect fill="#FFFFFF" height="52.0469" style="stroke:#181818;stroke-width:1.0;" width="10" x="651.5" y="204.8516"/><rect fill="#FFFFFF" height="85.5703" style="stroke:#181818;stroke-width:1.0;" width="10" x="876.5" y="299.7109"/><rect fill="#FFFFFF" height="85.5703" style="stroke:#181818;stroke-width:1.0;" width="10" x="876.5" y="462.3281"/><rect fill="#FFFFFF" height="28.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="1053" y="328.2344"/><rect fill="#FFFFFF" height="28.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="1173" y="490.8516"/><rect fill="#FFFFFF" height="28.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="1448.5" y="645.5859"/><rect fill="none" height="173.4297" style="stroke:#000000;stroke-width:1.5;" width="834" x="294" y="219.8516"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="27" x2="27" y1="117.2813" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="177" x2="177" y1="117.2813" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="402" x2="402" y1="117.2813" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="656" x2="656" y1="117.2813" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="881" x2="881" y1="117.2813" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1058" x2="1058" y1="117.2813" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1178" x2="1178" y1="117.2813" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1289" x2="1289" y1="586.2188" y2="749.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1453" x2="1453" y1="117.2813" y2="749.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="5" y="114.3145">ACME</text><ellipse cx="27.5" cy="50.1406" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.5,58.1406 L27.5,85.1406 M14.5,66.1406 L40.5,66.1406 M27.5,85.1406 L14.5,100.1406 M27.5,85.1406 L40.5,100.1406 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="5" y="760.8301">ACME</text><ellipse cx="27.5" cy="772.2969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.5,780.2969 L27.5,807.2969 M14.5,788.2969 L40.5,788.2969 M27.5,807.2969 L14.5,822.2969 M27.5,807.2969 L40.5,822.2969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="117" y="86.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="124" y="106.3145">ReviewController</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="121" x="117" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="124" y="767.8301">ReviewController</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197" x="304" y="86.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183" x="311" y="106.3145">reviewService:ReviewService</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="197" x="304" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183" x="311" y="767.8301">reviewService:ReviewService</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="548" y="86.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="555" y="106.3145">productRepo:ProductRepository</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="217" x="548" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="203" x="555" y="767.8301">productRepo:ProductRepository</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="775" y="86.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="782" y="106.3145">requestService:RequestService</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="775" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="782" y="767.8301">requestService:RequestService</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="998" y="86.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1005" y="106.3145">:ProductInstance</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="120" x="998" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="1005" y="767.8301">:ProductInstance</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="1128" y="86.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="1135" y="106.3145">:AuthInstance</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="1128" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="1135" y="767.8301">:AuthInstance</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="1238" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1245" y="767.8301">review:Review</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="205" x="1351" y="86.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="1358" y="106.3145">reviewRepo:ReviewRepository</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="205" x="1351" y="748.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="1358" y="767.8301">reviewRepo:ReviewRepository</text><rect fill="#FFFFFF" height="612.875" style="stroke:#181818;stroke-width:1.0;" width="10" x="22.5" y="127.2813"/><rect fill="#FFFFFF" height="583.3516" style="stroke:#181818;stroke-width:1.0;" width="10" x="172.5" y="147.8047"/><rect fill="#FFFFFF" height="563.8281" style="stroke:#181818;stroke-width:1.0;" width="10" x="397.5" y="176.3281"/><rect fill="#FFFFFF" height="273.8281" style="stroke:#181818;stroke-width:1.0;" width="10" x="402.5" y="428.8047"/><rect fill="#FFFFFF" height="52.0469" style="stroke:#181818;stroke-width:1.0;" width="10" x="651.5" y="204.8516"/><rect fill="#FFFFFF" height="85.5703" style="stroke:#181818;stroke-width:1.0;" width="10" x="876.5" y="299.7109"/><rect fill="#FFFFFF" height="85.5703" style="stroke:#181818;stroke-width:1.0;" width="10" x="876.5" y="462.3281"/><rect fill="#FFFFFF" height="28.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="1053" y="328.2344"/><rect fill="#FFFFFF" height="28.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="1173" y="490.8516"/><rect fill="#FFFFFF" height="28.5234" style="stroke:#181818;stroke-width:1.0;" width="10" x="1448.5" y="645.5859"/><polygon fill="#181818" points="160.5,143.8047,170.5,147.8047,160.5,151.8047,164.5,147.8047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="32.5" x2="166.5" y1="147.8047" y2="147.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="39.5" y="143.0498">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="50.5" y="143.0498">POST/reviews{sku}</text><polygon fill="#181818" points="385.5,172.3281,395.5,176.3281,385.5,180.3281,389.5,176.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="182.5" x2="391.5" y1="176.3281" y2="176.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="189.5" y="171.5732">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="200.5" y="171.5732">create(reviewDTO, sku, request)</text><polygon fill="#181818" points="639.5,200.8516,649.5,204.8516,639.5,208.8516,643.5,204.8516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="407.5" x2="645.5" y1="204.8516" y2="204.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="414.5" y="200.0967">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="425.5" y="200.0967">productRepo.findBySkuProduct(sku);</text><path d="M294,219.8516 L355,219.8516 L355,226.375 L345,236.375 L294,236.375 L294,219.8516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="173.4297" style="stroke:#000000;stroke-width:1.5;" width="834" x="294" y="219.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="16" x="309" y="232.6201">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="84" x="370" y="231.8096">[success case]</text><polygon fill="#181818" points="418.5,252.8984,408.5,256.8984,418.5,260.8984,414.5,256.8984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="412.5" x2="655.5" y1="256.8984" y2="256.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="424.5" y="252.1436">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="435.5" y="252.1436">product</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="294" x2="1128" y1="265.8984" y2="265.8984"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="89" x="299" y="275.8564">[product == null]</text><polygon fill="#181818" points="864.5,295.7109,874.5,299.7109,864.5,303.7109,868.5,299.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="407.5" x2="870.5" y1="299.7109" y2="299.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="414.5" y="294.9561">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="425.5" y="294.9561">retrieveProductFromApi(sku)</text><polygon fill="#181818" points="1041,324.2344,1051,328.2344,1041,332.2344,1045,328.2344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="886.5" x2="1047" y1="328.2344" y2="328.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="893.5" y="323.4795">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="904.5" y="323.4795">GET /products/{sku}</text><polygon fill="#181818" points="897.5,352.7578,887.5,356.7578,897.5,360.7578,893.5,356.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891.5" x2="1057" y1="356.7578" y2="356.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="903.5" y="352.0029">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="914.5" y="352.0029">product</text><polygon fill="#181818" points="418.5,381.2813,408.5,385.2813,418.5,389.2813,414.5,385.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="412.5" x2="880.5" y1="385.2813" y2="385.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="424.5" y="380.5264">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="435.5" y="380.5264">product</text><line style="stroke:#181818;stroke-width:1.0;" x1="407.5" x2="454.5" y1="415.8047" y2="415.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="454.5" x2="454.5" y1="415.8047" y2="428.8047"/><line style="stroke:#181818;stroke-width:1.0;" x1="413.5" x2="454.5" y1="428.8047" y2="428.8047"/><polygon fill="#181818" points="423.5,424.8047,413.5,428.8047,423.5,432.8047,419.5,428.8047" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="7" x="419.5" y="411.0498">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="430.5" y="411.0498">jwt = parseJwt(request)</text><polygon fill="#181818" points="864.5,458.3281,874.5,462.3281,864.5,466.3281,868.5,462.3281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="412.5" x2="870.5" y1="462.3281" y2="462.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="419.5" y="457.5732">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="437.5" y="457.5732">makeRequestToAuthentication(jwt)</text><polygon fill="#181818" points="1161,486.8516,1171,490.8516,1161,494.8516,1165,490.8516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="886.5" x2="1167" y1="490.8516" y2="490.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="893.5" y="486.0967">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="911.5" y="486.0967">GET /auth/search/{jwt}</text><polygon fill="#181818" points="897.5,515.375,887.5,519.375,897.5,523.375,893.5,519.375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891.5" x2="1177" y1="519.375" y2="519.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="903.5" y="514.6201">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="921.5" y="514.6201">user</text><polygon fill="#181818" points="423.5,543.8984,413.5,547.8984,423.5,551.8984,419.5,547.8984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="417.5" x2="880.5" y1="547.8984" y2="547.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="429.5" y="543.1436">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="447.5" y="543.1436">user</text><polygon fill="#181818" points="1226,572.4219,1236,576.4219,1226,580.4219,1230,576.4219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="412.5" x2="1232" y1="576.4219" y2="576.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="419.5" y="571.667">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="437.5" y="571.667">create(reviewDTO,sku,user.getId())</text><rect fill="#E2E2F0" height="29.6406" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="1238" y="555.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1245" y="575.5723">review:Review</text><polygon fill="#181818" points="423.5,613.0625,413.5,617.0625,423.5,621.0625,419.5,617.0625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="417.5" x2="1288.5" y1="617.0625" y2="617.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="429.5" y="612.3076">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="447.5" y="612.3076">review</text><polygon fill="#181818" points="1436.5,641.5859,1446.5,645.5859,1436.5,649.5859,1440.5,645.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="412.5" x2="1442.5" y1="645.5859" y2="645.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="419.5" y="640.8311">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="437.5" y="640.8311">reviewRepo.save(review)</text><polygon fill="#181818" points="423.5,670.1094,413.5,674.1094,423.5,678.1094,419.5,674.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="417.5" x2="1452.5" y1="674.1094" y2="674.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="429.5" y="669.3545">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="447.5" y="669.3545">ok</text><polygon fill="#181818" points="193.5,698.6328,183.5,702.6328,193.5,706.6328,189.5,702.6328" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="187.5" x2="396.5" y1="702.6328" y2="702.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="199.5" y="697.8779">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="217.5" y="697.8779">ok</text><polygon fill="#181818" points="43.5,727.1563,33.5,731.1563,43.5,735.1563,39.5,731.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37.5" x2="176.5" y1="731.1563" y2="731.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="14" x="49.5" y="726.4014">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="14" x="67.5" y="726.4014">ok</text><!--MD5=[097ea7fc86b7c515aa3bec33afc5fb6c]
@startuml
'https://plantuml.com/sequence-diagram
title Review and rate a product
autoactivate on
autonumber

actor "ACME" as User
participant "ReviewController" as Ctrl
participant "reviewService:ReviewService" as Svc
participant "productRepo:ProductRepository" as repository
participant "requestService:RequestService" as request
participant ":ProductInstance" as instance
participant ":AuthInstance" as instanceAuth
participant "review:Review" as review
participant "reviewRepo:ReviewRepository" as Repo

activate User

User -> Ctrl : POST/reviews{sku}

Ctrl -> Svc : create(reviewDTO, sku, request)
Svc -> repository : productRepo.findBySkuProduct(sku);
alt success case
repository - -> Svc : product
else product == null
Svc -> request:retrieveProductFromApi(sku)
request -> instance: GET /products/{sku}
instance - -> request: product
request - -> Svc: product
end
Svc -> Svc: jwt = parseJwt(request)
Svc -> request: makeRequestToAuthentication(jwt)
request -> instanceAuth: GET /auth/search/{jwt}
instanceAuth - -> request: user
request - -> Svc: user
Svc -> review** : create(reviewDTO,sku,user.getId())
review - -> Svc :  review
Svc -> Repo : reviewRepo.save(review)
Repo - -> Svc : ok
Svc - -> Ctrl : ok
Ctrl - -> User : ok

@enduml

@startuml
title Review and rate a product
autoactivate on
autonumber

actor "ACME" as User
participant "ReviewController" as Ctrl
participant "reviewService:ReviewService" as Svc
participant "productRepo:ProductRepository" as repository
participant "requestService:RequestService" as request
participant ":ProductInstance" as instance
participant ":AuthInstance" as instanceAuth
participant "review:Review" as review
participant "reviewRepo:ReviewRepository" as Repo

activate User

User -> Ctrl : POST/reviews{sku}

Ctrl -> Svc : create(reviewDTO, sku, request)
Svc -> repository : productRepo.findBySkuProduct(sku);
alt success case
repository - -> Svc : product
else product == null
Svc -> request:retrieveProductFromApi(sku)
request -> instance: GET /products/{sku}
instance - -> request: product
request - -> Svc: product
end
Svc -> Svc: jwt = parseJwt(request)
Svc -> request: makeRequestToAuthentication(jwt)
request -> instanceAuth: GET /auth/search/{jwt}
instanceAuth - -> request: user
request - -> Svc: user
Svc -> review** : create(reviewDTO,sku,user.getId())
review - -> Svc :  review
Svc -> Repo : reviewRepo.save(review)
Repo - -> Svc : ok
Svc - -> Ctrl : ok
Ctrl - -> User : ok

@enduml

PlantUML version 1.2022.12(Sun Oct 23 19:12:26 WEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: pt
Country: PT
--></g></svg>